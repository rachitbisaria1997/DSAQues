create database dbName;
drop database name;
drop database if exists db_name;
show databases;

DDL - create, alter, rename, truncate, drop
DQL = select
DCL = grant, revoke


insert into student(rollno, name) values(101, 'rachit');
create table temp1(id int not null, name varchar(50), age int, city varchar(30), primary key(id, name));

create table tab1(id int, age int check(age >=18));

create table city(id int primary key, city varchar(20), constraint age_check check (age >=18 and age <=16));

select name, city from student where marks >= 80;
select name, city from student where city = 'noida';

select * from student where marks between 80 and 90;

select *from student where city in('Delhi', 'Noida');

select city, avg(marks) from student group by city order by avg(marks) desc;

select city, count(name) from student group by city having max(marks) > 90;

update student set marks = marks + 10 where grade = 'E';

update student set grade = 'C' where marks between 80 and 90;

create table dept(id int primary key, name varchar(20));

update student set grade = 'C' where marks between 80 and 90;

delete from student where marks < 30;

create table dept(
id int primary key,
name varchar(20)
);

create table teacher(
id int primary key,
name varchar(20),
dept_id int,
foreign key(dept_id) references dept(id)
);

select count(name), city from student group by city having max(marks) > 90;

alter table tab_name
add column age int check age >=18;

alter table table_name
drop column col_name;

alter table table_name
rename to new_tab_name;

alter table table_name
change column age new_age int check age >=30;

select * from student as s
inner join course c
on s.id = c.id;

select * from student as s
left join course c
on s.id = c.id;

select * from student as s
right join course c
on s.id = c.id;

select * from student as s
left join course as c
on s.id = c.id
union
select * from student as s
right join course as c
on s.id = c.id;


select name from tableA
union
select name from tableB;

union all gives duplicates also
select name from tableA
union all
select name from tableB;

//sub queries

select name, marks from student where marks > (select avg(marks) from student);

select name, roll from student where rollNo in (select rollNo from student where rollNo % 2 == 0);

create view view1 as
select rollno, name from student;

select * from view1;
drop view view1;

helps in restricting users in viewing sensitive columns
like phone-number

CREATE VIEW customer_public AS
SELECT customer_name, city
FROM customers;

select * from student where name like 'S%';
name starting with S;

select * from student where firstName like '[bsp]%';
firstName starts with bs or p

dropping index

alter table person
drop constraint cons_name;

2nd higest salary

select max(salary) from employees where salary < (select max(salary) from employees);

// find duplicate records
select name, count(*)
from employees
group by name
having count(*) > 1;

Find Duplicate Records

select name, count(*) from employee
group by name
having count(*) > 1;

Find Employees Who Don’t Have a Manager
select * from employees
where manager_id is null;

Find Employees With Same Salary
select salary, count(*)
from employees
group by salary
having count(*) > 1;

Highest Purchase Customer in Last 1 Year

select cust_id
from orders
where order_date BETWEEN '2024-01-01' AND '2024-12-31'
group by cust_id
order by sum(amount) desc
limi1;

Find Department-Wise Highest Salary
SELECT department_id, MAX(salary) AS max_salary
FROM employees
GROUP BY department_id;

Count Employees Department-Wise

select dept_id , count(*) as total_employees
from employees
group by dept_id;


Q. find 2nd highest salary department wise

SELECT
    e1.department,
    MAX(e1.salary) AS second_highest_salary
FROM
    Employee e1
WHERE
    e1.salary < (
        SELECT MAX(e2.salary)
        FROM Employee e2
        WHERE e1.department = e2.department
    )
GROUP BY
    e1.department;


Q. how to prevent SQL injection ?

Use PreparedStatement instead of Statement.

String query = "SELECT * FROM users WHERE username = ? AND password = ?";
PreparedStatement pstmt = connection.prepareStatement(query);
pstmt.setString(1, username);
pstmt.setString(2, password);
ResultSet rs = pstmt.executeQuery();


Q. Different types of index in SQL

1. Unique index - Ensures that values in the indexed column(s) are unique
create table users(
  id int auto_increment primary key,
  username varchar(20),
  email varchar(20),
  unique(email);
);

INSERT INTO Users (username, email) VALUES ('Alice', 'alice@example.com');
INSERT INTO Users (username, email) VALUES ('Bob', 'alice@example.com');  -- ❌ Error: Duplicate key

2. Clustered index - data rows are stored in the order of clustered_index. table can have only 1 clustered index.

CREATE TABLE Orders (
    order_id INT PRIMARY KEY,  -- Automatically becomes a Clustered Index
    order_date DATE,
    customer_id INT
);

Data rows in the table are stored in the order of order_id.

3. non clustered index

CREATE TABLE Products (
    product_id INT PRIMARY KEY,  -- Clustered Index
    name VARCHAR(100),
    category VARCHAR(50),
    price DECIMAL(10,2)
);

create index idx_category ON Products(category);

data itself is not sorted by category index as its non clustered

Q. how to do transactions in SQL
A Transaction is a sequence of one or more SQL operations (queries) that are treated as a single unit of work.
Once a transaction is committed, changes are permanent even if system crashes

if any error occurs, than rollback the changes

Begin transaction

insert into UserAccount(user_id, email) values(1, 'user@example,com');

update Account SET balance = balance - 100 where user_id = 1;

COMMIT;

EXCEPTION
 when others then
 Rollback;

End;

Q. Find employees who were NOT present on a given date

Employee (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(100),
    supervisor_id INT
)

Attendance (
    id INT PRIMARY KEY,
    emp_id INT,
    attendance_date DATE,
    present CHAR(1) -- 'Y' or 'N'
)


select e.emp_id, e.emp_name, e.emp_id  as supervisor_id, s.emp_name as supervisor_name
from Employee e
left join Employee s
on e.supervisor_id = s.emp_id
left join Attendance a
on e.emp_id = a.emp_id and a.attendance_date = '2025-09-21'
where a.present is Null or a.present = 'N';